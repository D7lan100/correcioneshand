{% extends "base.html" %}

{% block title %}Productos{% endblock %}

{% block content %}
<style>
  body { 
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  }

  .products-container {
    background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,249,250,0.8));
    padding: 30px;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
    margin-top: 20px;
  }

  .product-card { 
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    padding: 20px;
    text-align: center;
    border-radius: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.08), 0 2px 10px rgba(0,0,0,0.05);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    border: 1px solid rgba(255,255,255,0.8);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    height: 100%;
  }

  .product-card:hover { 
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 20px 40px rgba(0,128,255,0.15), 0 10px 25px rgba(0,0,0,0.1);
    border-color: rgba(0,128,255,0.3);
  }

  .product-image-container {
    position: relative;
    margin-bottom: 15px;
    border-radius: 15px;
    overflow: hidden;
    background: linear-gradient(45deg, #f1f3f4, #e8eaed);
    height: 180px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .product-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card:hover .product-image {
    transform: scale(1.05);
  }

  .no-image-placeholder {
    color: #6c757d;
    font-size: 48px;
    opacity: 0.5;
  }

  .product-title {
    color: #2d3748;
    font-weight: 700;
    font-size: 18px;
    margin-bottom: 8px;
  }

  .product-description {
    font-size: 14px;
    color: #6c757d;
    min-height: 40px;
    margin-bottom: 10px;
  }

  .product-price {
    color: #0080FF;
    font-weight: 800;
    font-size: 20px;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0,128,255,0.1);
  }

  .product-badges {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }

  .badge-custom {
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .badge-available { background: linear-gradient(135deg, #48bb78, #38a169); color: white; }
  .badge-unavailable { background: linear-gradient(135deg, #f56565, #e53e3e); color: white; }
  .badge-customizable { background: linear-gradient(135deg, #ed8936, #dd6b20); color: white; }

  .btn-cart, .btn-details {
    background: linear-gradient(135deg, #0080FF, #3399FF);
    color: white;
    padding: 8px 12px;
    border-radius: 12px;
    font-weight: 600;
    border: none;
    transition: all 0.3s;
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    width: 100%;
    font-size: 14px;
  }

  .btn-cart:hover, .btn-details:hover {
    background: linear-gradient(135deg, #0066CC, #2685E6);
    transform: translateY(-2px);
  }

  .form-add-cart {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-bottom: 8px;
  }

  .form-add-cart input[type=number] {
    width: 60px;
    border-radius: 10px;
    border: 1px solid #ccc;
    text-align: center;
    padding: 4px 0;
  }

  .no-products-alert {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px;
    border-radius: 15px;
    text-align: center;
  }

  .no-products-alert .btn-home {
    margin-top: 20px;
    background: white;
    color: #0080FF;
    padding: 10px 25px;
    border-radius: 25px;
    text-decoration: none;
    font-weight: 600;
    display: inline-block;
    transition: all 0.3s;
  }

  .no-products-alert .btn-home:hover { background: #f8f9fa; color: #0080FF; }

  .search-container { margin: 20px 0; }
  .search-input { border-radius: 15px; }
  .search-btn { border-radius: 15px; background: linear-gradient(135deg, #0080FF, #3399FF); border: none; color: white; }
  .search-btn:hover { background: linear-gradient(135deg, #0066CC, #2685E6); }
  
  /* Estilos de Paginación */
  .pagination .page-link {
    color: #0080FF;
    border-radius: 10px;
    margin: 0 3px;
    transition: all 0.3s;
    border: 1px solid #0080FF;
  }

  .pagination .page-item.active .page-link {
    background: linear-gradient(135deg, #0080FF, #3399FF);
    color: white;
    border-color: #0080FF;
    box-shadow: 0 4px 8px rgba(0,128,255,0.3);
  }

  .pagination .page-link:hover {
    background-color: #f0f8ff;
    border-color: #0080FF;
    color: #0066CC;
  }

  .pagination .page-item.disabled .page-link {
    color: #ccc;
    border-color: #eee;
    background-color: #fafafa;
  }
</style>

<div class="container products-container">
  <h1 class="page-title text-center mb-4">
    {% if termino_busqueda %}
      Resultados para: "{{ termino_busqueda }}"
    {% elif categoria_id %}
      Productos de la categoría
    {% else %}
      Nuestros Productos
    {% endif %}
  </h1>

    <div class="search-container">
    <form action="{{ url_for('productos_bp.buscar_productos') }}" method="GET" class="search-form">
      <div class="d-flex gap-3 justify-content-center">
        <input type="text" name="q" class="form-control search-input flex-grow-1" 
               placeholder="Buscar productos increíbles..." 
               value="{{ termino_busqueda if termino_busqueda else '' }}">
        <button type="submit" class="btn search-btn"><i class="bi bi-search"></i> Buscar</button>
      </div>
    </form>
  </div>

  {% if productos %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 g-4 justify-content-center">
      {% for producto in productos %}
        <div class="col d-flex">
          <div class="product-card w-100 d-flex flex-column">
            <div class="product-image-container">
              {% if producto.imagen %}
                <img src="{{ producto.imagen }}" class="product-image" alt="{{ producto.nombre }}">
              {% else %}
                <div class="no-image-placeholder"><i class="bi bi-image"></i></div>
              {% endif %}
            </div>

            <h5 class="product-title">{{ producto.nombre }}</h5>
            <p class="product-description">
              {{ producto.descripcion or "Producto increíble esperando por ti" }}
            </p>

            <div class="product-price">${{ "%.2f"|format(producto.precio) }}</div>

            <div class="product-badges">
              {% if producto.disponible %}
                <span class="badge-custom badge-available"><i class="bi bi-check-circle"></i> Disponible</span>
              {% else %}
                <span class="badge-custom badge-unavailable"><i class="bi bi-x-circle"></i> Agotado</span>
              {% endif %}
              {% if producto.es_personalizable %}
                <span class="badge-custom badge-customizable"><i class="bi bi-palette"></i> Personalizable</span>
              {% endif %}
            </div>

            {% if producto.disponible %}
            <form action="{{ url_for('carrito_bp.agregar', id_producto=producto.id_producto) }}" method="POST" class="form-add-cart">
              <input type="number" name="cantidad" value="1" min="1" required>
              <button type="submit" class="btn-cart"><i class="bi bi-cart-plus"></i> Agregar</button>
            </form>
            {% endif %}

            <a href="{{ url_for('productos_bp.detalle_producto', id_producto=producto.id_producto) }}" class="btn-details mt-auto">
              <i class="bi bi-eye"></i> Ver detalles
            </a>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if pagination and pagination.pages > 1 %}
    <div class="row mt-5">
      <div class="col-12">
        <nav aria-label="Navegación de productos">
          <ul class="pagination justify-content-center">
            
            <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
              <a class="page-link" href="{% if pagination.has_prev %}{{ url_for_pagination(pagination.prev_num) }}{% else %}#{% endif %}" aria-label="Anterior">
                <span aria-hidden="true">&laquo;</span>
                <span class="sr-only">Anterior</span>
              </a>
            </li>
            
            {% for page_num in pagination.iter_pages(left_edge=2, right_edge=2, left_current=1, right_current=2) %}
              {% if page_num %}
                {% if page_num == pagination.page %}
                  <li class="page-item active" aria-current="page"><a class="page-link" href="#">{{ page_num }}</a></li>
                {% else %}
                  <li class="page-item"><a class="page-link" href="{{ url_for_pagination(page_num) }}">{{ page_num }}</a></li>
                {% endif %}
              {% else %}
                <li class="page-item disabled"><span class="page-link">...</span></li>
              {% endif %}
            {% endfor %}
            
            <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
              <a class="page-link" href="{% if pagination.has_next %}{{ url_for_pagination(pagination.next_num) }}{% else %}#{% endif %}" aria-label="Siguiente">
                <span aria-hidden="true">&raquo;</span>
                <span class="sr-only">Siguiente</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
    {% endif %}
    
  {% else %}
    <div class="no-products-alert mt-4">
      <i class="bi bi-search"></i>
      <h4>No se encontraron productos</h4>
      {% if termino_busqueda %}
        <p>No hay productos que coincidan con "{{ termino_busqueda }}"</p>
      {% else %}
        <p>Actualmente no hay productos disponibles. ¡Pronto tendremos productos increíbles para ti!</p>
      {% endif %}
      <a href="{{ url_for('home_bp.home') }}" class="btn-home"><i class="bi bi-house"></i> Volver al inicio</a>
    </div>
  {% endif %}
</div>
{% endblock %}
